rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Default rule - allows read/write for development
    // IMPORTANT: Update these rules for production use
    match /{allPaths=**} {
      allow read, write: if true;
    }
    
    // Example: User-specific files
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Example: Public read, authenticated write
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Example: Profile images with size limits
    match /profiles/{userId}/avatar.{ext} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.uid == userId &&
        ext.matches('(jpg|jpeg|png|gif)') &&
        request.resource.size < 5 * 1024 * 1024; // 5MB limit
    }
    
    // Example: Admin-only files
    match /admin/{allPaths=**} {
      allow read, write: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // Example: Temporary uploads (auto-delete after 1 day)
    match /temp/{userId}/{filename} {
      allow read, write: if request.auth != null && 
        request.auth.uid == userId &&
        request.time < resource.timeCreated + duration.value(1, 'd');
    }
  }
}